<!DOCTYPE html>
<html lang="pt">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Clinica Vitale ‚Äì Chat</title>

		<link
			href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css"
			rel="stylesheet"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css"
			rel="stylesheet"
		/>

		<style>
			/* ====== Tema Cl√≠nico ‚Äì Vitale ====== */
			:root {
				/* Cores base */
				--vitale-primary: #006993;
				--vitale-primary-600: #035a7b;
				--vitale-accent: #02a6a9;
				--vitale-bg: #f6f8fa;
				--vitale-text: #1f2937;
				--vitale-muted: #6b7280;
				--vitale-success: #1f9d55;

				/* Bubbles */
				--user-bubble-bg: #e8f2f7;
				--bot-bubble-bg: #ffffff;
				--bubble-radius: 14px;

				/* Borda/sombra */
				--frame-border: 1px solid #e5e7eb;
				--frame-shadow: 0 8px 30px rgba(0, 0, 0, 0.06);

				/* Tipografia */
				--chat-font: Inter, system-ui, -apple-system, Segoe UI, Roboto,
					"Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji",
					"Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif;

				/* Inputs */
				--input-bg: #ffffff;
				--input-border: #d1d5db;
				--input-focus: var(--vitale-primary);
			}

			body {
				height: 100%;
				background: #334155;
				margin: 8px 16px;
				font-family: var(--chat-font);
			}

			/* ====== Container geral ====== */
			#n8n-chat {
				font-family: var(--chat-font);
			}

			/* Janela/flutuante */
			.n8n-chat-window,
			.chat-window {
				background: var(--vitale-bg);
				border: var(--frame-border);
				box-shadow: var(--frame-shadow);
				border-radius: 16px !important;
				overflow: hidden;
			}

			/* Header compacto e profissional */
			.chat-header {
				display: flex;
				align-items: center;
				gap: 10px;
				background: linear-gradient(0deg, #f9fafb 0%, #ffffff 100%);
				border-bottom: var(--frame-border);
				padding: 5px 10px !important;
			}
			.chat-heading {
				padding: 0 !important;
			}
			.chat-header .title {
				color: var(--vitale-primary);
				font-weight: 600;
				letter-spacing: 0.2px;
			}
			.chat-header .subtitle {
				color: var(--vitale-muted);
				font-size: 12px;
			}

			/* √Årea das mensagens */
			.message-list,
			.chat-messages {
				padding: 14px 14px 6px !important;
			}

			/* Bolhas */
			.message.bot,
			.message.assistant {
				background: var(--bot-bubble-bg);
				border: 1px solid #eef2f7;
				border-radius: var(--bubble-radius);
				color: var(--vitale-text);
				padding: 10px 12px;
				margin: 8px 0;
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
			}
			.message.user {
				background: var(--user-bubble-bg);
				border: 1px solid #dbe7ee;
				border-radius: var(--bubble-radius);
				color: var(--vitale-text);
				padding: 10px 12px;
				margin: 8px 0;
			}
			.message a {
				color: var(--vitale-primary);
				text-decoration: none;
				border-bottom: 1px dotted var(--vitale-primary);
			}
			.message a:hover {
				color: var(--vitale-primary-600);
			}

			/* Inputs */
			textarea,
			.composer textarea,
			.chat-textarea textarea {
				background: #fff !important;
				border: 1px solid var(--input-border) !important;
				border-radius: 12px !important;
				outline: none;
				min-height: 44px;
				padding: 10px 12px !important;
				resize: none;
				transition: border-color 0.15s ease;
			}
			textarea:focus {
				border-color: var(--input-focus) !important;
				box-shadow: 0 0 0 3px rgba(0, 105, 147, 0.12);
			}

			/* Bot√µes */
			button,
			.send-button,
			.primary {
				border-radius: 12px !important;
			}
			.send-button,
			.primary {
				background: var(--vitale-primary) !important;
				border: 1px solid var(--vitale-primary) !important;
				color: #fff !important;
			}
			.send-button:hover,
			.primary:hover {
				background: var(--vitale-primary-600) !important;
				border-color: var(--vitale-primary-600) !important;
			}

			/* Welcome */
			.welcome,
			.get-started {
				background: #ffffff;
				border: 1px solid #eef2f7;
				border-radius: 16px;
				padding: 18px;
			}

			/* Rodap√© */
			.chat-footer,
			.footer {
				color: var(--vitale-muted);
				font-size: 12px;
				padding: 6px 12px;
				border-top: var(--frame-border);
			}

			/* Acessibilidade */
			.chat-window button:focus-visible {
				outline: 3px solid rgba(0, 105, 147, 0.35);
				outline-offset: 2px;
			}

			/* Dark mode */
			@media (prefers-color-scheme: dark) {
				:root {
					--vitale-bg: #0b1220;
					--vitale-text: #e5e7eb;
					--bot-bubble-bg: #101827;
					--user-bubble-bg: #0f2530;
					--frame-border: 1px solid #1f2937;
					--input-bg: #0b1220;
					--input-border: #334155;
				}
				.chat-header {
					background: linear-gradient(0deg, #0b1220 0%, #101827 100%);
					border-bottom: var(--frame-border);
				}
			}

			/* Oculta "Powered by n8n" */
			.chat-powered-by,
			.chat-get-started-footer .chat-powered-by {
				display: none !important;
			}

			/* ====== Nudge / Dica para abrir o chat ====== */
			.chat-nudge {
				position: fixed;
				right: 92px; /* fica acima e √† esquerda do bot√£o rosa */
				bottom: 92px;
				background: #ffffff;
				border: 1px solid #e5e7eb;
				box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
				border-radius: 14px;
				padding: 14px 16px;
				max-width: 280px;
				z-index: 2147483000; /* acima do widget */
				display: flex;
				align-items: flex-start;
				gap: 10px;
				animation: nudge-in 0.35s ease-out both;
			}
			@keyframes nudge-in {
				from {
					opacity: 0;
					transform: translate3d(0, 8px, 0) scale(0.98);
				}
				to {
					opacity: 1;
					transform: translate3d(0, 0, 0) scale(1);
				}
			}
			.chat-nudge .arrow {
				position: absolute;
				right: -10px;
				bottom: 16px;
				width: 22px;
				height: 22px;
				background: #fff;
				border-right: 1px solid #e5e7eb;
				border-bottom: 1px solid #e5e7eb;
				transform: rotate(-45deg);
				border-bottom-right-radius: 6px;
			}
			.nudge-title {
				font-weight: 600;
				font-size: 14px;
				color: #0f2530;
				margin-bottom: 4px;
			}
			.nudge-text {
				font-size: 13px;
				color: var(--vitale-muted);
				line-height: 1.35;
			}
			.nudge-actions {
				margin-top: 10px;
				display: flex;
				gap: 8px;
				flex-wrap: wrap;
			}
			.nudge-actions .nudge-btn {
				font-size: 12px;
				padding: 8px 10px;
				border-radius: 10px;
				border: 1px solid var(--vitale-primary);
				background: var(--vitale-primary);
				color: #fff;
				cursor: pointer;
			}
			.nudge-dismiss {
				background: transparent;
				color: var(--vitale-primary);
				border-color: #d1e4ee;
			}

			/* Anel de pulso pr√≥ximo ao bot√£o rosa para chamar aten√ß√£o */
			.pulse {
				position: fixed;
				right: 20px;
				bottom: 20px;
				width: 56px;
				height: 56px;
				border-radius: 999px;
				pointer-events: none;
				box-shadow: 0 0 0 0 rgba(255, 0, 0, 0);
			}
			.pulse::after {
				content: "";
				position: absolute;
				inset: 0;
				border-radius: 50%;
				border: 3px solid rgba(236, 72, 153, 0.55); /* tom pr√≥ximo ao rosa do bot√£o */
				animation: ring 1.6s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
			}
			@keyframes ring {
				0% {
					transform: scale(0.85);
					opacity: 0.8;
				}
				70% {
					transform: scale(1.35);
					opacity: 0;
				}
				100% {
					transform: scale(1.35);
					opacity: 0;
				}
			}

			/* Em telas pequenas, deixar o nudge menor e um pouco mais alto */
			@media (max-width: 640px) {
				.chat-nudge {
					right: 78px;
					bottom: 88px;
					max-width: 230px;
				}
			}
		</style>
	</head>
	<body>
		<!-- Se√ß√£o de Instru√ß√µes para Teste -->
		<div
			style="
				max-width: 800px;
				margin: 20px auto;
				padding: 20px;
				background: #f0f4f8;
				border-left: 4px solid #006993;
				border-radius: 8px;
			"
		>
			<h2 style="color: #006993; margin-top: 0">
				üß™ Ajude-nos a Melhorar o Assistente
			</h2>
			<p style="color: #1f2937; line-height: 1.6">
				Estamos refinando a persona e o comportamento do nosso assistente
				virtual. Sua intera√ß√£o √© fundamental! Por favor, fa√ßa as seguintes
				perguntas no chat e compartilhe suas considera√ß√µes:
			</p>

			<div
				style="
					background: white;
					padding: 15px;
					border-radius: 6px;
					margin: 15px 0;
				"
			>
				<h3 style="color: #035a7b; margin-top: 0">
					üìã Script de Perguntas-Teste
				</h3>

				<details style="margin: 10px 0; cursor: pointer">
					<summary style="font-weight: 600; color: #006993">
						1Ô∏è‚É£ Agendamento (Tarefa Prim√°ria)
					</summary>
					<ul style="margin-top: 10px; color: #1f2937">
						<li>"Como fa√ßo para marcar uma consulta?"</li>
						<li>
							"Tenho d√∫vida sobre hor√°rios dispon√≠veis para segunda-feira"
						</li>
						<li>"Preciso urgente de um atendimento hoje"</li>
					</ul>
				</details>

				<details style="margin: 10px 0; cursor: pointer">
					<summary style="font-weight: 600; color: #006993">
						2Ô∏è‚É£ Informa√ß√µes Cl√≠nicas
					</summary>
					<ul style="margin-top: 10px; color: #1f2937">
						<li>"Quais especialidades voc√™s t√™m?"</li>
						<li>"Preciso de um dermatologista, qual o valor da consulta?"</li>
						<li>"Como funciona a primeira consulta?"</li>
					</ul>
				</details>

				<details style="margin: 10px 0; cursor: pointer">
					<summary style="font-weight: 600; color: #006993">
						3Ô∏è‚É£ Informa√ß√µes Pr√°ticas
					</summary>
					<ul style="margin-top: 10px; color: #1f2937">
						<li>"Qual o endere√ßo da cl√≠nica?"</li>
						<li>"Quais s√£o os hor√°rios de atendimento?"</li>
						<li>"Voc√™s aceitam qual tipo de pagamento?"</li>
					</ul>
				</details>

				<details style="margin: 10px 0; cursor: pointer">
					<summary style="font-weight: 600; color: #006993">
						4Ô∏è‚É£ Conversa√ß√£o Natural (Empatia)
					</summary>
					<ul style="margin-top: 10px; color: #1f2937">
						<li>"Estou muito ansiosa com uma consulta marcada"</li>
						<li>"Tive uma experi√™ncia ruim em outra cl√≠nica"</li>
						<li>"Pode me recomendar um m√©dico?"</li>
					</ul>
				</details>

				<details style="margin: 10px 0; cursor: pointer">
					<summary style="font-weight: 600; color: #006993">
						5Ô∏è‚É£ Cen√°rios Complexos (Edge Cases)
					</summary>
					<ul style="margin-top: 10px; color: #1f2937">
						<li>"Preciso cancelar/reagendar uma consulta j√° marcada"</li>
						<li>"Qual o status da minha consulta?"</li>
						<li>"Tenho uma alergia a certos medicamentos, como informar?"</li>
					</ul>
				</details>
			</div>

			<div
				style="
					background: #e8f2f7;
					padding: 15px;
					border-radius: 6px;
					margin: 15px 0;
				"
			>
				<h3 style="color: #035a7b; margin-top: 0">üìù O que Avaliar</h3>
				<ul style="color: #1f2937; margin: 0; padding-left: 20px">
					<li><strong>Tom:</strong> √â profissional mas acolhedor?</li>
					<li>
						<strong>Clareza:</strong> As respostas s√£o diretas e compreens√≠veis?
					</li>
					<li><strong>Pr√≥ximos Passos:</strong> O bot oferece a√ß√µes claras?</li>
					<li>
						<strong>Empatia:</strong> Reconhece sentimentos e preocupa√ß√µes?
					</li>
					<li>
						<strong>Limites:</strong> Sabe quando deve escalar para um humano?
					</li>
					<li>
						<strong>Personaliza√ß√£o:</strong> Adapta respostas ao contexto?
					</li>
				</ul>
			</div>

			<div
				style="
					background: #fff;
					padding: 15px;
					border: 1px solid #d1d5db;
					border-radius: 6px;
				"
			>
				<h3 style="color: #035a7b; margin-top: 0">üí° Como Contribuir</h3>
				<ol
					style="
						color: #1f2937;
						margin: 0;
						padding-left: 20px;
						line-height: 1.8;
					"
				>
					<li>Abra o chat clicando no √≠cone rosa no canto inferior direito</li>
					<li>Fa√ßa as perguntas acima (pode ser todas ou algumas)</li>
					<li>Anote suas observa√ß√µes sobre tom, clareza e relev√¢ncia</li>
					<li>Compartilhe feedback: "O bot foi √∫til? Ficou algo faltando?"</li>
					<li>Envie suas considera√ß√µes para melhorias üìß</li>
				</ol>
			</div>

			<p
				style="
					color: #6b7280;
					font-size: 14px;
					margin: 15px 0 0 0;
					text-align: center;
				"
			>
				‚ú® Seu feedback nos ajuda a criar um assistente mais humano, inteligente
				e √∫til!
			</p>
		</div>

		<!-- Elemento do widget -->
		<div id="n8n-chat" aria-label="Assistente cl√≠nico Vitale"></div>

		<!-- Nudge (chamado √† a√ß√£o) -->
		<div class="chat-nudge" id="chatNudge" role="dialog" aria-live="polite">
			<div>
				<div class="nudge-title">Teste o assistente</div>
				<div class="nudge-text">
					Clique no √≠cone rosa no canto para abrir o chat. Se quiser, j√° pode
					perguntar: <em>‚ÄúComo marcar uma consulta?‚Äù</em>
				</div>
			</div>
			<span class="arrow" aria-hidden="true"></span>
		</div>

		<!-- Pulso perto do bot√£o do chat -->
		<div class="pulse" id="chatPulse" aria-hidden="true"></div>

		<script type="module">
			import { createChat } from "https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js";

			const chat = createChat({
				webhookUrl:
					"http://35.214.27.181:5678/webhook/bccee70b-3800-4ec6-8503-c73fca8366a9/chat",
				webhookConfig: { method: "POST", headers: {} },
				target: "#n8n-chat",
				mode: "window",
				chatInputKey: "chatInput",
				chatSessionKey: "sessionId",
				loadPreviousSession: true,
				metadata: {},
				showWelcomeScreen: true,
				defaultLanguage: "pt",
				initialMessages: [
					"Sou o assistente da Cl√≠nica Vitale, como posso ajudar-te?",
				],
				i18n: {
					pt: {
						title: "Cl√≠nica Vitale üëã",
						subtitle: "",
						footer: "Informa√ß√£o geral ‚Äî n√£o substitui aconselhamento m√©dico.",
						getStarted: "Nova conversa",
						inputPlaceholder: "Digite a sua mensagem...",
					},
				},
				enableStreaming: false,
			});

			/* Utilidades do nudge */
			const nudge = document.getElementById("chatNudge");
			const pulse = document.getElementById("chatPulse");
			const btnOpen = document.getElementById("openChatNow");
			const btnDismiss = document.getElementById("dismissNudge");

			// Tenta encontrar o bot√£o flutuante do widget para "clicar" via JS
			function clickLauncher() {
				// Heur√≠sticas para diferentes builds do n8n chat
				const candidates = [
					'button[aria-label*="open"]',
					'button[aria-label*="Open"]',
					'button[aria-label*="chat"]',
					".n8n-chat-toggle",
					".chat-toggle",
					".n8n-chat .toggle",
					".n8n-chat button",
				];
				for (const sel of candidates) {
					const el = document.querySelector(sel);
					if (el) {
						el.click();
						return true;
					}
				}
				return false;
			}

			// Esconde nudge/pulse com anima√ß√£o simples
			function hideNudge() {
				if (!nudge) return;
				nudge.style.opacity = "0";
				nudge.style.transform = "translateY(4px)";
				setTimeout(() => {
					nudge.style.display = "none";
				}, 250);
				if (pulse) pulse.style.display = "none";
			}

			// Bot√µes do nudge
			btnOpen?.addEventListener("click", () => {
				const opened = clickLauncher();
				hideNudge();
				// fallback: se n√£o achou o bot√£o, ainda assim some ap√≥s clique
				if (!opened)
					console.warn("Launcher do chat n√£o encontrado (ok, nudge ocultado).");
			});
			btnDismiss?.addEventListener("click", hideNudge);

			// Auto-ocultar quando o chat abrir (observa elementos de janela)
			const observer = new MutationObserver(() => {
				const isOpen = document.querySelector(".n8n-chat-window, .chat-window");
				if (isOpen) hideNudge();
			});
			observer.observe(document.documentElement, {
				childList: true,
				subtree: true,
			});

			// Auto-ocultar depois de 12s se o usu√°rio ignorar
			setTimeout(() => hideNudge(), 12000);
		</script>
	</body>
</html>
